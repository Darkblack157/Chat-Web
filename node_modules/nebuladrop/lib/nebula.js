const NodeCache = require('node-cache');
const { encrypt, decrypt } = require('./crypto');

class NebulaDrop {
    constructor(apiKey) {
        this.apiKey = apiKey;
        this.dataStore = new NodeCache();
    }

    send(channel, { payload, ttl = 3600 }) {
        const encryptedData = encrypt(payload, this.apiKey);
        this.dataStore.set(channel, encryptedData, ttl);
    }

    receive(channel) {
        const item = this.dataStore.get(channel);
        if (!item) return null;
        return decrypt(item, this.apiKey);
    }

    cleanup() {
        this.dataStore.flushAll();
    }
}

module.exports = NebulaDrop;
